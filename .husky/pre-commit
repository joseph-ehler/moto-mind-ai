#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üõ°Ô∏è  MotoMind Quality Checks - Validating staged files..."
echo ""

# Check 1: Hardcoded URLs
echo "üîç Checking for hardcoded URLs..."
if git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' | xargs grep -l "http://localhost\|https://motomind\.app" 2>/dev/null | grep -v "^docs/\|^scripts/\|test\|spec"; then
  echo ""
  echo "‚ùå Hardcoded URLs detected in staged files!"
  echo "Use apiUrl() from @/lib/utils/api-url instead"
  echo ""
  exit 1
fi
echo "‚úÖ No hardcoded URLs"

# Check 2: Non-barrel imports
echo "üéØ Checking for non-barrel imports..."
if git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx)$' | xargs grep -l "from '../.*primitives\|from '../.*patterns\|from '../.*feedback" 2>/dev/null | grep -v "^components/design-system/index"; then
  echo ""
  echo "‚ùå Non-barrel imports detected!"
  echo "Use: import { Component } from '@/components/design-system'"
  echo ""
  exit 1
fi
echo "‚úÖ All imports use barrel exports"

# Check 3: AI Pattern Enforcer
echo "üõ°Ô∏è  Running AI Pattern Enforcer..."
npx tsx scripts/ai-platform/enforce-patterns-ai.ts --validate

if [ $? -ne 0 ]; then
  echo ""
  echo "‚ùå Pattern violations detected!"
  echo ""
  echo "üí° Options:"
  echo "  1. Auto-fix: npm run ai-platform:enforce -- --auto-fix"
  echo "  2. Review:   cat .ai-patterns.json"
  echo "  3. Bypass:   git commit --no-verify (not recommended)"
  echo ""
  exit 1
fi

echo ""
echo "‚úÖ All quality checks passed! Commit proceeding..."
